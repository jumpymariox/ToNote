"use strict";
Component({
    properties: {
        defaultValue: {
            type: String, observer: function (newValue) {
                this.setDefaultValue(newValue);
            }
        }
    },
    data: {
        readOnly: false,
        placeholder: "开始笔记",
        usingKeyboard: false,
        focusing: false
    },
    lifetimes: {
        attached: function () {
            var platform = wx.getSystemInfoSync().platform;
            var isIOS = platform === 'ios';
            this.setData({ isIOS: isIOS });
            var that = this;
            this.toggleShowTooltip(0);
            var keyboardHeight = 0;
            wx.onKeyboardHeightChange(function (res) {
                if (res.height === keyboardHeight)
                    return;
                var duration = res.height > 0 ? res.duration * 1000 : 0;
                keyboardHeight = res.height;
                setTimeout(function () {
                    wx.pageScrollTo({
                        scrollTop: 0,
                        success: function () {
                            that.toggleShowTooltip(keyboardHeight);
                            that.data.editorCtx.scrollIntoView();
                        }
                    });
                }, duration);
            });
        }
    },
    methods: {
        readOnlyChange: function () {
            this.setData({
                readOnly: !this.data.readOnly
            });
        },
        calNavigationBarAndStatusBar: function () {
            var systemInfo = wx.getSystemInfoSync();
            var statusBarHeight = systemInfo.statusBarHeight, platform = systemInfo.platform;
            var isIOS = platform === 'ios';
            var navigationBarHeight = isIOS ? 44 : 48;
            return statusBarHeight + navigationBarHeight;
        },
        onEditorReady: function () {
            var _this = this;
            this.createSelectorQuery().select('#editor').context(function (res) {
                _this.setData({ editorCtx: res.context });
                _this.setDefaultValue(_this.properties.defaultValue);
            }).exec();
        },
        focus: function () {
            this.setData({ focusing: true });
        },
        blur: function () {
            this.setData({ focusing: false });
        },
        format: function (e) {
            var _a = e.target.dataset, name = _a.name, value = _a.value;
            if (!name)
                return;
            this.data.editorCtx.format(name, value);
        },
        onStatusChange: function (e) {
            var formats = e.detail;
            this.setData({ formats: formats });
        },
        insertDivider: function () {
            this.data.editorCtx.insertDivider({
                success: function () {
                    console.log('insert divider success');
                }
            });
        },
        clear: function () {
            this.data.editorCtx.clear({
                success: function () {
                    console.log("clear success");
                }
            });
        },
        removeFormat: function () {
            this.data.editorCtx.removeFormat();
        },
        insertDate: function () {
            var date = new Date();
            var formatDate = date.getFullYear() + "/" + (date.getMonth() + 1) + "/" + date.getDate();
            this.data.editorCtx.insertText({
                text: formatDate
            });
        },
        insertImage: function () {
            var that = this;
            wx.chooseImage({
                count: 1,
                success: function (res) {
                    that.data.editorCtx.insertImage({
                        src: res.tempFilePaths[0],
                        data: {
                            id: 'abcd',
                            role: 'god'
                        },
                        width: '80%',
                        success: function () {
                            console.log('insert image success');
                        }
                    });
                }
            });
        },
        toggleShowTooltip: function (keyboardHeight) {
            if (!this.data.focusing) {
                this.setData({ usingKeyboard: false });
                return;
            }
            this.setData({ usingKeyboard: keyboardHeight > 0 });
        },
        setDefaultValue: function (value) {
            if (!this.data.editorCtx) {
                return;
            }
            this.data.editorCtx.setContents({ html: value });
        },
        getContents: function () {
            var _this = this;
            return new Promise(function (resolve) {
                _this.data.editorCtx.getContents({
                    success: function (editorContents) { resolve(editorContents); }
                });
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90ZS1lZGl0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJub3RlLWVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBcUNBLFNBQVMsQ0FBNEI7SUFJbkMsVUFBVSxFQUFFO1FBQ1YsWUFBWSxFQUFFO1lBQ1osSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLFlBQUMsUUFBZ0I7Z0JBQ3JDLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakMsQ0FBQztTQUNGO0tBQ0Y7SUFLRCxJQUFJLEVBQUU7UUFDSixRQUFRLEVBQUUsS0FBSztRQUNmLFdBQVcsRUFBRSxNQUFNO1FBQ25CLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLFFBQVEsRUFBRSxLQUFLO0tBQ2hCO0lBRUQsU0FBUyxFQUFFO1FBQ1QsUUFBUTtZQUNOLElBQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLFFBQVEsQ0FBQTtZQUNoRCxJQUFNLEtBQUssR0FBRyxRQUFRLEtBQUssS0FBSyxDQUFBO1lBQ2hDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLENBQUE7WUFDdkIsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFBO1lBQ2pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQixJQUFJLGNBQWMsR0FBRyxDQUFDLENBQUE7WUFDdEIsRUFBRSxDQUFDLHNCQUFzQixDQUFDLFVBQUMsR0FBUTtnQkFDakMsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLGNBQWM7b0JBQUUsT0FBTTtnQkFDekMsSUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3pELGNBQWMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO2dCQUMzQixVQUFVLENBQUM7b0JB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QUN4QixPQUFNO2FBQ1A7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNuRCxDQUFDO1FBQ0QsV0FBVyxFQUFYO1lBQUEsaUJBTUM7WUFMQyxPQUFPLElBQUksT0FBTyxDQUFpQixVQUFDLE9BQU87Z0JBQ3pDLEtBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQztvQkFDOUIsT0FBTyxZQUFDLGNBQThCLElBQUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFBLENBQUMsQ0FBQztpQkFDcEUsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDO0tBQ0Y7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBjb21wb25lbnRzL25vdGUtZWRpdG9yL25vdGUtZWRpdG9yLmpzXG5cbnR5cGUgSVByb3BlcnR5ID0ge1xuICBkZWZhdWx0VmFsdWU6IFdlY2hhdE1pbmlwcm9ncmFtLkNvbXBvbmVudC5BbGxQcm9wZXJ0eVxufVxudHlwZSBJRGF0YSA9IHtcbiAgZWRpdG9yQ3R4PzogYW55LFxuICBwbGFjZWhvbGRlcj86IHN0cmluZyxcbiAgcmVhZE9ubHk6IGJvb2xlYW4sXG4gIHVzaW5nS2V5Ym9hcmQ6IGJvb2xlYW4sXG4gIGZvY3VzaW5nOiBib29sZWFuXG59XG50eXBlIElDdXN0b20gPSB7XG4gIHJlYWRPbmx5Q2hhbmdlOiAoKSA9PiB2b2lkLFxuICBjYWxOYXZpZ2F0aW9uQmFyQW5kU3RhdHVzQmFyOiAoKSA9PiB2b2lkLFxuICBvbkVkaXRvclJlYWR5OiAoKSA9PiB2b2lkLFxuICBmb2N1czogKCkgPT4gdm9pZCxcbiAgYmx1cjogKCkgPT4gdm9pZCxcbiAgb25TdGF0dXNDaGFuZ2U6IChlOiBhbnkpID0+IHZvaWQsXG4gIGZvcm1hdDogKGU6IGFueSkgPT4gdm9pZCxcbiAgaW5zZXJ0RGl2aWRlcjogKCkgPT4gdm9pZCxcbiAgY2xlYXI6ICgpID0+IHZvaWQsXG4gIHJlbW92ZUZvcm1hdDogKCkgPT4gdm9pZCxcbiAgaW5zZXJ0RGF0ZTogKCkgPT4gdm9pZCxcbiAgaW5zZXJ0SW1hZ2U6ICgpID0+IHZvaWQsXG4gIHRvZ2dsZVNob3dUb29sdGlwOiAoa2V5Ym9hcmRIZWlnaHQ6IG51bWJlcikgPT4gdm9pZFxuICBzZXREZWZhdWx0VmFsdWU6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkLFxuICBnZXRDb250ZW50czogKCkgPT4gUHJvbWlzZTxFZGl0b3JDb250ZW50cz5cbn1cblxuaW50ZXJmYWNlIEVkaXRvckNvbnRlbnRzIHtcbiAgZGVsdGE6IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIGVyck1zZzogc3RyaW5nLFxuICBodG1sOiBzdHJpbmcsXG4gIHRleHQ6IHN0cmluZ1xufVxuXG5Db21wb25lbnQ8SURhdGEsIElQcm9wZXJ0eSwgSUN1c3RvbT4oe1xuICAvKipcbiAgICogQ29tcG9uZW50IHByb3BlcnRpZXNcbiAgICovXG4gIHByb3BlcnRpZXM6IHtcbiAgICBkZWZhdWx0VmFsdWU6IHtcbiAgICAgIHR5cGU6IFN0cmluZywgb2JzZXJ2ZXIobmV3VmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLnNldERlZmF1bHRWYWx1ZShuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBDb21wb25lbnQgaW5pdGlhbCBkYXRhXG4gICAqL1xuICBkYXRhOiB7XG4gICAgcmVhZE9ubHk6IGZhbHNlLFxuICAgIHBsYWNlaG9sZGVyOiBcIuW8gOWni+eslOiusFwiLFxuICAgIHVzaW5nS2V5Ym9hcmQ6IGZhbHNlLFxuICAgIGZvY3VzaW5nOiBmYWxzZVxuICB9LFxuXG4gIGxpZmV0aW1lczoge1xuICAgIGF0dGFjaGVkKCkge1xuICAgICAgY29uc3QgcGxhdGZvcm0gPSB3eC5nZXRTeXN0ZW1JbmZvU3luYygpLnBsYXRmb3JtXG4gICAgICBjb25zdCBpc0lPUyA9IHBsYXRmb3JtID09PSAnaW9zJ1xuICAgICAgdGhpcy5zZXREYXRhKHsgaXNJT1MgfSlcbiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgICB0aGlzLnRvZ2dsZVNob3dUb29sdGlwKDApO1xuICAgICAgbGV0IGtleWJvYXJkSGVpZ2h0ID0gMFxuICAgICAgd3gub25LZXlib2FyZEhlaWdodENoYW5nZSgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHJlcy5oZWlnaHQgPT09IGtleWJvYXJkSGVpZ2h0KSByZXR1cm5cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSByZXMuaGVpZ2h0ID4gMCA/IHJlcy5kdXJhdGlvbiAqIDEwMDAgOiAwXG4gICAgICAgIGtleWJvYXJkSGVpZ2h0ID0gcmVzLmhlaWdodFxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB3eC5wYWdlU2Nyb2xsVG8oe1xuICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLFxuICAgICAgICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgdGhhdC50b2dnbGVTaG93VG9vbHRpcChrZXlib2FyZEhlaWdodCk7XG4gICAgICAgICAgICAgIHRoYXQuZGF0YS5lZGl0b3JDdHguc2Nyb2xsSW50b1ZpZXcoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH0sIGR1cmF0aW9uKVxuXG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogQ29tcG9uZW50IG1ldGhvZHNcbiAgICovXG4gIG1ldGhvZHM6IHtcbiAgICByZWFkT25seUNoYW5nZSgpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHJlYWRPbmx5OiAhdGhpcy5kYXRhLnJlYWRPbmx5XG4gICAgICB9KVxuICAgIH0sXG4gICAgY2FsTmF2aWdhdGlvbkJhckFuZFN0YXR1c0JhcigpIHtcbiAgICAgIGNvbnN0IHN5c3RlbUluZm8gPSB3eC5nZXRTeXN0ZW1JbmZvU3luYygpXG4gICAgICBjb25zdCB7IHN0YXR1c0JhckhlaWdodCwgcGxhdGZvcm0gfSA9IHN5c3RlbUluZm9cbiAgICAgIGNvbnN0IGlzSU9TID0gcGxhdGZvcm0gPT09ICdpb3MnXG4gICAgICBjb25zdCBuYXZpZ2F0aW9uQmFySGVpZ2h0ID0gaXNJT1MgPyA0NCA6IDQ4XG4gICAgICByZXR1cm4gc3RhdHVzQmFySGVpZ2h0ICsgbmF2aWdhdGlvbkJhckhlaWdodFxuICAgIH0sXG4gICAgb25FZGl0b3JSZWFkeSgpIHtcbiAgICAgIHRoaXMuY3JlYXRlU2VsZWN0b3JRdWVyeSgpLnNlbGVjdCgnI2VkaXRvcicpLmNvbnRleHQoKHJlczogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7IGVkaXRvckN0eDogcmVzLmNvbnRleHQgfSk7XG4gICAgICAgIHRoaXMuc2V0RGVmYXVsdFZhbHVlKHRoaXMucHJvcGVydGllcy5kZWZhdWx0VmFsdWUpO1xuICAgICAgfSkuZXhlYygpXG4gICAgfSxcbiAgICBmb2N1cygpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7IGZvY3VzaW5nOiB0cnVlIH0pXG4gICAgfSxcbiAgICBibHVyKCkge1xuICAgICAgdGhpcy5zZXREYXRhKHsgZm9jdXNpbmc6IGZhbHNlIH0pXG4gICAgfSxcbiAgICBmb3JtYXQoZTogYW55KSB7XG4gICAgICBsZXQgeyBuYW1lLCB2YWx1ZSB9ID0gZS50YXJnZXQuZGF0YXNldFxuICAgICAgaWYgKCFuYW1lKSByZXR1cm5cbiAgICAgIHRoaXMuZGF0YS5lZGl0b3JDdHguZm9ybWF0KG5hbWUsIHZhbHVlKVxuXG4gICAgfSxcbiAgICBvblN0YXR1c0NoYW5nZShlOiBhbnkpIHtcbiAgICAgIGNvbnN0IGZvcm1hdHMgPSBlLmRldGFpbFxuICAgICAgdGhpcy5zZXREYXRhKHsgZm9ybWF0cyB9KVxuICAgIH0sXG4gICAgaW5zZXJ0RGl2aWRlcigpIHtcbiAgICAgIHRoaXMuZGF0YS5lZGl0b3JDdHguaW5zZXJ0RGl2aWRlcih7XG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnaW5zZXJ0IGRpdmlkZXIgc3VjY2VzcycpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgICBjbGVhcigpIHtcbiAgICAgIHRoaXMuZGF0YS5lZGl0b3JDdHguY2xlYXIoe1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJjbGVhciBzdWNjZXNzXCIpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgICByZW1vdmVGb3JtYXQoKSB7XG4gICAgICB0aGlzLmRhdGEuZWRpdG9yQ3R4LnJlbW92ZUZvcm1hdCgpXG4gICAgfSxcbiAgICBpbnNlcnREYXRlKCkge1xuICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGZvcm1hdERhdGUgPSBgJHtkYXRlLmdldEZ1bGxZZWFyKCl9LyR7ZGF0ZS5nZXRNb250aCgpICsgMX0vJHtkYXRlLmdldERhdGUoKX1gXG4gICAgICB0aGlzLmRhdGEuZWRpdG9yQ3R4Lmluc2VydFRleHQoe1xuICAgICAgICB0ZXh0OiBmb3JtYXREYXRlXG4gICAgICB9KVxuICAgIH0sXG4gICAgaW5zZXJ0SW1hZ2UoKSB7XG4gICAgICBjb25zdCB0aGF0ID0gdGhpc1xuICAgICAgd3guY2hvb3NlSW1hZ2Uoe1xuICAgICAgICBjb3VudDogMSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlczogYW55KSB7XG4gICAgICAgICAgdGhhdC5kYXRhLmVkaXRvckN0eC5pbnNlcnRJbWFnZSh7XG4gICAgICAgICAgICBzcmM6IHJlcy50ZW1wRmlsZVBhdGhzWzBdLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBpZDogJ2FiY2QnLFxuICAgICAgICAgICAgICByb2xlOiAnZ29kJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdpZHRoOiAnODAlJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2luc2VydCBpbWFnZSBzdWNjZXNzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgdG9nZ2xlU2hvd1Rvb2x0aXAoa2V5Ym9hcmRIZWlnaHQ6IG51bWJlcikge1xuICAgICAgaWYgKCF0aGlzLmRhdGEuZm9jdXNpbmcpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHsgdXNpbmdLZXlib2FyZDogZmFsc2UgfSlcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgICB0aGlzLnNldERhdGEoeyB1c2luZ0tleWJvYXJkOiBrZXlib2FyZEhlaWdodCA+IDAgfSlcbiAgICB9LFxuICAgIHNldERlZmF1bHRWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICBpZiAoIXRoaXMuZGF0YS5lZGl0b3JDdHgpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgICB0aGlzLmRhdGEuZWRpdG9yQ3R4LnNldENvbnRlbnRzKHsgaHRtbDogdmFsdWUgfSk7XG4gICAgfSxcbiAgICBnZXRDb250ZW50cygpOiBQcm9taXNlPEVkaXRvckNvbnRlbnRzPiB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8RWRpdG9yQ29udGVudHM+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHRoaXMuZGF0YS5lZGl0b3JDdHguZ2V0Q29udGVudHMoe1xuICAgICAgICAgIHN1Y2Nlc3MoZWRpdG9yQ29udGVudHM6IEVkaXRvckNvbnRlbnRzKSB7IHJlc29sdmUoZWRpdG9yQ29udGVudHMpIH1cbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIH1cbiAgfVxufSlcbiJdfQ==